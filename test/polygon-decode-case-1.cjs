/*
 * Copyright (c) 2020-2025 TomTom International B.V.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

const assert = require('assert');
const { Buffer } = require('buffer');
const { BinaryDecoder, LocationReference } = require('../lib/es5');

const openLrString = 'E//oWiSg4f/lABz/n//6/+n/uAAR/+0AGv/t/0f/wgAO//AAlwA3/+H/1gAl//YAagAEACv//wB4//QAEAAKABAAFAAN//UAF//7/7X/2f8D/5gAX/5b/u7/4v4V/8n/N//q/6r/+f/8/+sAVAABA6wAYABFAAoAIv/+AJr/9AA7//sAOP/4AD4AEwAQAIT/+QB9/+kAZ//fAFIAbwAh/+sAJgAzABYAEwAj//wABf8ZACoABgAOADcAIwA9ACAAJQAVAFUALQDZAGkAYv+3AEMAH//yADAASwAZAA0AQABXACEAOgAWAGMAIwBxABwAVQAiAEf/hQAaAAX/uQB/AFcAFv/lABr/nwAf/+4AAv8v/6b/x/+5/9L/6wASAE4AFQAnACEAGwAuABP/pAAh/7n/pP/C/97/4//o/2r/uwAJ//T/Rf+5/7T/5/+N/8wAAf/HABP/4P97/7j/2P/z/48ALv9uACo=';
const expectedCoordinates = [
    [-0.12989401817259838, 51.508723497145134],
    [-0.13016401816213963, 51.50900349715261],
    [-0.1311429679038315, 51.5089424468842],
    [-0.13136856316060627, 51.50821807385541],
    [-0.13120459754946862, 51.50803997068028],
    [-0.1309429361711519, 51.507846851631214],
    [-0.13279544410699007, 51.50722373258209],
    [-0.1326508039049293, 51.50706146010084],
    [-0.13113060023106718, 51.50762125638899],
    [-0.1314485631585853, 51.5072091558704],
    [-0.13106897057087816, 51.50712146009933],
    [-0.13001419010043974, 51.507154171735195],
    [-0.1295927642198133, 51.507147087080696],
    [-0.1283936107059349, 51.507037087083475],
    [-0.12823198112830764, 51.50714979871732],
    [-0.12808177742347437, 51.50735708707539],
    [-0.12796157371424527, 51.50724020612866],
    [-0.1277328276767813, 51.50719291777018],
    [-0.1284767932950948, 51.50681000242362],
    [-0.13100781175246667, 51.505773764323706],
    [-0.13005981710676964, 51.50157379613844],
    [-0.1328056794585046, 51.501278092315246],
    [-0.13772226171504706, 51.50072768492281],
    [-0.13973606843435657, 51.50049978544301],
    [-0.14060308964623558, 51.500435208721676],
    [-0.14064139655898802, 51.500230835708855],
    [-0.13980431191090484, 51.500236258985744],
    [-0.13040746282719465, 51.501207716633864],
    [-0.12971900228814437, 51.501313311900944],
    [-0.12938235679695925, 51.50130060026457],
    [-0.1278390340733692, 51.50117914259498],
    [-0.1272440816386095, 51.501141854232614],
    [-0.12669472448699964, 51.501068938889134],
    [-0.12607682502069634, 51.50125310820475],
    [-0.12591455253945152, 51.50257622728712],
    [-0.12599434883244592, 51.50383660289115],
    [-0.12621872185203706, 51.50486114794509],
    [-0.12655475625009624, 51.505681116179375],
    [-0.12543662136825925, 51.50600650771408],
    [-0.12564082237017135, 51.506399830470365],
    [-0.12513539910955046, 51.506626068558],
    [-0.12494041495605776, 51.506970645264985],
    [-0.12497729591209006, 51.50701396803011],
    [-0.12729021115168937, 51.507426883372275],
    [-0.12723763984771047, 51.50757603682173],
    [-0.12668326683281786, 51.50793624051035],
    [-0.12606536736651455, 51.50824956326865],
    [-0.1257045525411186, 51.508461428356846],
    [-0.12485977209811691, 51.508916005071974],
    [-0.12268146523214947, 51.50996661615677],
    [-0.12170424032897861, 51.509238042099184],
    [-0.12102718744368936, 51.509548481279076],
    [-0.12117199959117483, 51.510040346345654],
    [-0.12043220328574958, 51.51028241515627],
    [-0.12030118476774859, 51.510929907193656],
    [-0.11943243874645237, 51.51126363738325],
    [-0.11884267418588378, 51.511496960129016],
    [-0.11785331705994115, 51.51184153683601],
    [-0.11672626412417421, 51.51211485960987],
    [-0.11586900748023987, 51.51245380933863],
    [-0.11515070061376952, 51.51122713204125],
    [-0.11489259742611127, 51.511284044781796],
    [-0.11560510535436844, 51.51254696013523],
    [-0.11473320855238299, 51.512762962784045],
    [-0.11499344397397955, 51.51301753950422],
    [-0.11597239371567143, 51.51332503157202],
    [-0.11614798897007131, 51.51335689665022],
    [-0.11822965042610221, 51.51245835433831],
    [-0.11879104451452821, 51.51174713210087],
    [-0.11926040169726287, 51.511539028915585],
    [-0.11907101279882662, 51.51231445219485],
    [-0.11886935142627016, 51.51269692839008],
    [-0.1185347746935593, 51.512963166476695],
    [-0.11808290961141983, 51.513162116230816],
    [-0.11901229852754192, 51.51349523528363],
    [-0.1197249784012238, 51.512588558007266],
    [-0.12034308159433958, 51.51224587812787],
    [-0.12063535407593831, 51.51200255537872],
    [-0.12214576150233139, 51.51131652096404],
    [-0.12205779853626117, 51.51119987547457],
    [-0.12393196788558275, 51.51050258711796],
    [-0.12468878534796227, 51.51025448391914],
    [-0.12582980387319032, 51.50972699186417],
    [-0.12582851814235277, 51.50916200776004],
    [-0.12564851813598601, 51.50885410826772],
    [-0.12697539909217198, 51.50813224316693],
    [-0.12737577475430434, 51.50801413999756],
    [-0.1285134705243146, 51.50847539397542],
    [-0.12998072721468468, 51.50890746274849]
]

const binaryDecoder = new BinaryDecoder();
const openLrBinary = Buffer.from(openLrString, 'base64');
const locationReference = LocationReference.fromIdAndBuffer('binary', openLrBinary);
const rawLocationReference = binaryDecoder.decodeData(locationReference);
const coordinates = rawLocationReference.getCornerPoints().map((coordinates) => [coordinates.getLongitudeDeg(), coordinates.getLatitudeDeg()]);

assert.deepStrictEqual(expectedCoordinates, coordinates);
